<!DOCTYPE html>
<html>

<head>
  <base target="_top">
  <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
  <style>
    body {
      padding: 20px;
      font-size: 14px;
      /* Increased slightly */
    }

    .block {
      margin-bottom: 15px;
      /* Increased spacing */
    }

    .actions {
      margin-top: 25px;
    }

    input[type="text"],
    input[type="number"],
    select {
      width: 100%;
      box-sizing: border-box;
      font-size: 14px;
      /* Consistent font size */
      padding: 4px;
      /* More padding for larger font */
    }

    #expenseAmount {
      width: 150px;
    }

    label {
      font-size: 14px;
      margin-bottom: 4px;
      display: block;
    }

    .inline-group {
      display: flex;
      gap: 20px;
    }

    .inline-group .block {
      flex: 1;
    }

    .checkbox-row {
      display: flex;
      gap: 20px;
      align-items: center;
    }

    .checkbox-inline {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      font-size: 14px;
      cursor: pointer;
    }

    .checkbox-inline input[type="checkbox"] {
      margin: 0;
    }
  </style>

</head>

<body>
  <form id="expenseForm">
    <div class="block form-group">
      <label for="expenseName"><b>Expense Name</b></label>
      <input type="text" id="expenseName" placeholder="Electricity Bill" required>
    </div>

    <div class="block form-group">
      <label for="expenseType"><b>Expense Type</b></label>
      <input type="text" id="expenseType" list="typeChoices" placeholder="Utilities" required>
      <datalist id="typeChoices">
        <? for (var i = 0; i < expenseTypes.length; i++) { ?>
        <option value="<?= expenseTypes[i] ?>">
          <? } ?>
      </datalist>
    </div>

    <div class="block form-group">
      <label for="expenseAmount"><b>Amount ($)</b></label>
      <input type="number" step="0.01" id="expenseAmount" placeholder="0.00">
    </div>

    <div class="block checkbox-group">
      <input type="checkbox" id="papCheckbox">
      <label for="papCheckbox">Pre-authorized payment?</label>
    </div>

    <div class="block checkbox-group">
      <input type="checkbox" id="splitCheckbox">
      <label for="splitCheckbox">Split payment?</label>
    </div>

    <div class="block checkbox-group">
      <input type="checkbox" id="paidCheckbox">
      <label for="paidCheckbox">Paid?</label>
    </div>

    <div class="block form-group">
      <label for="expensePeriod"><b>Billing Period</b></label>
      <input type="text" id="expensePeriod" placeholder="e.g. monthly">
    </div>

    <div class="block form-group">
      <label for="paidBySelect"><b>Paid By</b></label>
      <select id="paidBySelect">
        <option value="">-- Select --</option>
        <? for (var i = 0; i < spouseNames.length; i++) { ?>
        <option value="<?= spouseNames[i] ?>">
          <?= spouseNames[i] ?>
        </option>
        <? } ?>
      </select>
    </div>

    <div class="block actions">
      <button type="button" class="blue" id="submit-btn" onclick="submitForm()">Add Expense</button>
      <button type="button" onclick="google.script.host.close()">Cancel</button>
    </div>
  </form>

  <script>
    const executionMode = <?= mode ?>;

    function submitForm() {
      const btn = document.getElementById('submit-btn');
      btn.disabled = true;
      btn.textContent = 'Processing...';

      var name = document.getElementById('expenseName').value;
      var type = document.getElementById('expenseType').value;
      var amount = document.getElementById('expenseAmount').value;
      var pap = document.getElementById('papCheckbox').checked;
      var split = document.getElementById('splitCheckbox').checked;
      var paid = document.getElementById('paidCheckbox').checked;
      var period = document.getElementById('expensePeriod').value;

      var paidBy = document.getElementById('paidBySelect').value;

      if (!name || !type) {
        alert('Please fill in required fields.');
        btn.disabled = false;
        btn.textContent = 'Add Expense';
        return;
      }

      google.script.run
        .withSuccessHandler(closeDialog)
        .withFailureHandler(function (err) {
          alert('Error: ' + err);
          btn.disabled = false;
          btn.textContent = 'Add Expense';
        })
        .processForm(name, type, amount, pap, period, executionMode, split, paid, paidBy);
    }

    function closeDialog() {
      google.script.host.close();
    }
  </script>
</body>

</html>